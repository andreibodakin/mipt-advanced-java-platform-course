
# üß© –õ–µ–∫—Ü–∏—è 3 ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ Java

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã

- –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π Java: –∏–µ—Ä–∞—Ä—Ö–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

## üó∫Ô∏è –ò–µ—Ä–∞—Ä—Ö–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

package java.util;

Collection.java

public interface Collection<E> extends Iterable<E>

<img src="images/collection-interfaces.png" width="80%" />

![–°—Ö–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π](images/collection-interfaces.png)

![–°—Ö–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–π](images/collection-interfaces.png){ width=80% }

### `Iterable` ‚Üí `Collection<E>`

- `List<E>`
    - `ArrayList`
    - `LinkedList`
- `Set<E>`
    - `HashSet`
    - `LinkedHashSet`
    - `SortedSet<E>`
        - `TreeSet`
- `Queue<E>`
    - `PriorityQueue`
    - `Deque<E>`
        - `ArrayDeque`

> ‚ùó `Map<K,V>` **–Ω–µ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è** –æ—Ç `Collection`, –Ω–æ –≤—Ö–æ–¥–∏—Ç –≤ Collections Framework.

### `Map<K,V>`

- `SortedMap<K,V>`
    - `TreeMap`
- `HashMap`
- `ConcurrentMap<K,V>`
    - `ConcurrentHashMap`

## üì¶ ArrayList ‚Äî –º–∞—Å—Å–∏–≤ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä–æ—Å—Ç–æ–º

class ArrayList<E> {
    transient Object[] elementData; // –º–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    private int size;              // —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
}

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ List<String> list = new ArrayList<>(); ‚Äî —Å–æ–∑–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ –¥–ª–∏–Ω—ã 0 (lazy init).
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ ‚Äî –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Ä–∞–∑–º–µ—Ä–æ–º 10.
–ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ ‚Äî –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä:
newCapacity = oldCapacity + (oldCapacity >> 1) ‚Üí +50% (–Ω–µ 2x!)
‚úÖ –ü–æ—á–µ–º—É 1.5x, –∞ –Ω–µ 2x? ‚Äî –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ + –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —á–∞—Å—Ç–æ—Ç–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–µ–π.

Capacity –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π trimToSize() –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏.

## ‚è±Ô∏è –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å ArrayList

list.get(i); // O(1) –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –ø–æ –∏–Ω–¥–µ–∫—Å—É
list.add(value); // O(1)* - –∞–º–æ—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, O(n) - —Ö—É–¥—à–∞—è –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
list.add(i, value); // O(n) –°–¥–≤–∏–≥ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø—Ä–∞–≤–∞
list.remove(i); // O(n) –°–¥–≤–∏–≥ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ª–µ–≤–∞
list.contains(v); // O(n) –õ–∏–Ω–µ–π–Ω—ã–π –ø–æ–∏—Å–∫
iterator().next(); // O(1) –ë—ã—Å—Ç—Ä—ã–π –æ–±—Ö–æ–¥

## üîó LinkedList ‚Äî –¥–≤—É—Å–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫

–î–≤—É—Å–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫. –ü—Ä—ã–≥–∞–µ—Ç –ø–æ –ø–∞–º—è—Ç–∏, –ø–æ—ç—Ç–æ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ.

–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:
class Node<E> {
    E item;
    Node<E> next;
    Node<E> prev
}

–ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤ –∫—É—á–µ ‚Üí –ø—Ä—ã–∂–∫–∏ –ø–æ –ø–∞–º—è—Ç–∏ ‚Üí –ø–ª–æ—Ö–∞—è –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å ‚Üí –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º ArrayList –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤.
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ ‚Äî O(1)
–î–æ—Å—Ç—É–ø –ø–æ –∏–Ω–¥–µ–∫—Å—É ‚Äî O(n)

üß† –¶–∏—Ç–∞—Ç–∞ –æ—Ç Joshua Bloch (—Å–æ–∑–¥–∞—Ç–µ–ª—å LinkedList):
‚ÄúDoes anyone actually use LinkedList? I wrote it, and I never use it.‚Äù

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?
‚úÖ –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—ã –æ—á–µ–Ω—å —á–∞—Å—Ç–æ –≤—Å—Ç–∞–≤–ª—è–µ—à—å/—É–¥–∞–ª—è–µ—à—å –≤ –Ω–∞—á–∞–ª–µ –∏–ª–∏ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å–ø–∏—Å–∫–∞, –∏ –Ω–µ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –ø–æ –∏–Ω–¥–µ–∫—Å—É.
‚ùå –í 95% —Å–ª—É—á–∞–µ–≤ ‚Äî ArrayList –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.

## üö¶ Queue / Deque ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π

ArrayDeque ‚Äî —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –±—É—Ñ–µ—Ä (ring buffer).
 - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ ‚Äî O(1)
 - –†–µ–∞–ª–∏–∑—É–µ—Ç Deque ‚Üí –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å—Ç–µ–∫ –∏–ª–∏ –æ—á–µ—Ä–µ–¥—å.
 - –í–Ω—É—Ç—Ä–∏ ‚Äî –º–∞—Å—Å–∏–≤, —Ä–∞—Å—Ç—ë—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–µ: newSize = 2 * oldSize + 2
 - –ù–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω

‚úÖ –õ—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è —Å—Ç–µ–∫–∞/–æ—á–µ—Ä–µ–¥–∏ –≤ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–º –∫–æ–¥–µ ‚Üí –±—ã—Å—Ç—Ä–µ–µ LinkedList.

## üóÉÔ∏è HashMap ‚Äî —Ö–µ—à-—Ç–∞–±–ª–∏—Ü–∞

–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:

class HashMap<K,V> {
    Node<K,V>[] table; // –º–∞—Å—Å–∏–≤ "–∫–æ—Ä–∑–∏–Ω"
    int size;          // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
}

static class Node<K,V> implements Map.Entry<K,V> {
    final int hash;
    final K key;
    V value;
    Node<K,V> next;    // —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª –≤ —Ü–µ–ø–æ—á–∫–µ
}

 - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–µ–ø–æ—á–µ—á–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è.
 - –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ table = null ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º put() ‚Üí —Ä–∞–∑–º–µ—Ä 16.
 - Load factor = 0.75 ‚Üí –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 12 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ‚Üí —Ä–µ—Å–∞–π–∑ –¥–æ 32.
 - –†–µ—Å–∞–π–∑ ‚Üí –≤ 2 —Ä–∞–∑–∞.
 - –ö–æ–ª–ª–∏–∑–∏–∏ ‚Üí —Ü–µ–ø–æ—á–∫–∏ (linked list) ‚Üí —Å Java 8, –µ—Å–ª–∏ >8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ‚Üí –∫—Ä–∞—Å–Ω–æ-—á—ë—Ä–Ω–æ–µ –¥–µ—Ä–µ–≤–æ.
‚úÖ hashCode() ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ—Ä–∑–∏–Ω—É
‚úÖ equals() ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ç–æ—Ç –ª–∏ –∫–ª—é—á

## üå≤ TreeMap ‚Äî –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞–ø–∞

 - –û—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∫—Ä–∞—Å–Ω–æ-—á—ë—Ä–Ω–æ–º –¥–µ—Ä–µ–≤–µ ‚Üí —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ BST.
 - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî O(log n)
 - –ö–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å Comparable –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è Comparator
 - –ò—Ç–µ—Ä–∞—Ü–∏—è ‚Äî –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

 - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª—é—á–∞–º –∏–ª–∏ range-–∑–∞–ø—Ä–æ—Å—ã (subMap, headMap, tailMap)

## üß© HashSet, TreeSet, LinkedHashMap ‚Äî –æ–±—ë—Ä—Ç–∫–∏

### HashSet

 - –í–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HashMap<E, Object> ‚Üí –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –∑–∞–≥–ª—É—à–∫–∏ (PRESENT).
 - –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π ‚Äî –∫–∞–∫ —É HashMap: O(1)

### TreeSet

 - –í–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TreeMap<E, Object>
 - –°–ª–æ–∂–Ω–æ—Å—Ç—å ‚Äî O(log n)

### LinkedHashMap

 - –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç HashMap
 - –î–æ–±–∞–≤–ª—è–µ—Ç –¥–≤–æ–π–Ω–æ–π —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ (–∏–ª–∏ –¥–æ—Å—Ç—É–ø–∞)
 - –ò—Ç–µ—Ä–∞—Ü–∏—è ‚Äî –≤ –ø–æ—Ä—è–¥–∫–µ –≤—Å—Ç–∞–≤–∫–∏ (–∏–ª–∏ LRU, –µ—Å–ª–∏ accessOrder=true)
 - –ù–µ–±–æ–ª—å—à–æ–π overhead –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî –∫–∞–∫ —É HashMap
 - ‚úÖ –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è LRU-–∫—ç—à–µ–π ‚Üí –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏ removeEldestEntry()


## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

–ü–æ—á–µ–º—É ArrayList —á–∞—â–µ LinkedList?  
‚Üí –õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –º–µ–Ω—å—à–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π, –±—ã—Å—Ç—Ä–µ–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.  

–ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å hashCode() –∏ equals() –¥–ª—è –∫–ª—é—á–∞ –≤ HashMap?  
‚Üí –û–±—ä–µ–∫—Ç—ã –Ω–µ –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è ‚Üí –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.  

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ConcurrentHashMap?  
‚Üí –†–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã (–¥–æ Java 8) ‚Üí —Å Java 8 ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CAS + synchronized –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ—Ä–∑–∏–Ω—ã ‚Üí –≤—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å.  
Fail-Fast vs Fail-Safe?  
‚Üí ArrayList.iterator() ‚Äî fail-fast ‚Üí ConcurrentModificationException  
‚Üí ConcurrentHashMap.keySet().iterator() ‚Äî fail-safe ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–æ–ø–∏–µ–π  

–ö–∞–∫ —É–º–µ–Ω—å—à–∏—Ç—å capacity ArrayList?  
‚Üí trimToSize()  

## üìö –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é

üìñ Effective Java ‚Äî Joshua Bloch (–≥–ª–∞–≤—ã 3, 6 ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ equals/hashCode)

üìñ Java Concurrency in Practice ‚Äî Brian Goetz (–≥–ª–∞–≤–∞ 5 ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–∫–µ)

üåê [Oracle Java Collections Tutorial](https://docs.oracle.com/javase/tutorial/collections/?spm=a2ty_o01.29997173.0.0.1b35c921FmKv3G)
